/*!
 * Richarea - A JavaScript contentEditable munipulator library v0.1.2
 * http://github.com/lambdalisue/Richarea
 * 
 * Copyright 2011 (c) hashnote.net, Alisue allright reserved.
 * Licensed under the MIT license.
 * 
 * Last-Modified: Fri, 07 Oct 2011 18:27:17 GMT
 */
(function(){function g(b){this._document=b;this.startContainer=this.endContainer=b.body;this.endOffset=i.getNodeLength(b.body)}function n(b){this.range=b;if(!b.collapsed){var a=b.commonAncestorContainer;this._next=b.startContainer==a&&!i.isDataNode(b.startContainer)?b.startContainer.childNodes[b.startOffset]:i.findClosestAncestor(a,b.startContainer);this._end=b.endContainer==a&&!i.isDataNode(b.endContainer)?b.endContainer.childNodes[b.endOffset]:i.findClosestAncestor(a,b.endContainer).nextSibling}}
function m(b){this._document=b;var a=this;b.attachEvent("onselectionchange",function(){a._selectionChangeHandler()})}var i={findChildPosition:function(b){for(var a=0;b=b.previousSibling;a++);return a},isDataNode:function(b){return b&&b.nodeValue!==null&&b.data!==null},isAncestorOf:function(b,a){return!i.isDataNode(b)&&(b.contains(i.isDataNode(a)?a.parentNode:a)||a.parentNode==b)},isAncestorOrSelf:function(b,a){return i.isAncestorOf(b,a)||b==a},findClosestAncestor:function(b,a){if(i.isAncestorOf(b,
a))for(;a&&a.parentNode!=b;)a=a.parentNode;return a},getNodeLength:function(b){return i.isDataNode(b)?b.length:b.childNodes.length},splitDataNode:function(b,a){if(!i.isDataNode(b))return!1;var h=b.cloneNode(!1);b.deleteData(a,b.length);h.deleteData(0,a);b.parentNode.insertBefore(h,b.nextSibling)}},l={convertToDOMRange:function(b,a){function h(h,c,b){var j=a.createElement("a"),k=c.duplicate();k.collapse(b);var p=k.parentElement();do p.insertBefore(j,j.previousSibling),k.moveToElementText(j);while(k.compareEndPoints(b?
"StartToStart":"StartToEnd",c)>0&&j.previousSibling);if(k.compareEndPoints(b?"StartToStart":"StartToEnd",c)==-1&&j.nextSibling)k.setEndPoint(b?"EndToStart":"EndToEnd",c),h[b?"setStart":"setEnd"](j.nextSibling,k.text.length);else h[b?"setStartBefore":"setEndBefore"](j);j.parentNode.removeChild(j)}var c=new g(a);h(c,b,!0);h(c,b,!1);return c},convertFromDOMRange:function(b){function a(a,h,b){var f=h[b?"startContainer":"endContainer"],j=h[b?"startOffset":"endOffset"],k=0,p=i.isDataNode(f)?f:f.childNodes[j],
g=i.isDataNode(f)?f.parentNode:f;if(f.nodeType==3||f.nodeType==4)k=j;f=h._document.createElement("a");g.insertBefore(f,p);h=h._document.body.createTextRange();h.moveToElementText(f);f.parentNode.removeChild(f);a.setEndPoint(b?"StartToStart":"EndToStart",h);a[b?"moveStart":"moveEnd"]("character",k)}var h=b._document.body.createTextRange();a(h,b,!0);a(h,b,!1);return h}};g.START_TO_START=0;g.START_TO_END=1;g.END_TO_END=2;g.END_TO_START=3;g.prototype={startContainer:null,startOffset:0,endContainer:null,
endOffset:0,commonAncestorContainer:null,collapsed:!1,_document:null,_refreshProperties:function(){this.collapsed=this.startContainer==this.endContainer&&this.startOffset==this.endOffset;for(var b=this.startContainer;b&&b!=this.endContainer&&!i.isAncestorOf(b,this.endContainer);)b=b.parentNode;this.commonAncestorContainer=b},setStart:function(b,a){this.startContainer=b;this.startOffset=a;this._refreshProperties()},setEnd:function(b,a){this.endContainer=b;this.endOffset=a;this._refreshProperties()},
setStartBefore:function(b){this.setStart(b.parentNode,i.findChildPosition(b))},setStartAfter:function(b){this.setStart(b.parentNode,i.findChildPosition(b)+1)},setEndBefore:function(b){this.setEnd(b.parentNode,i.findChildPosition(b))},setEndAfter:function(b){this.setEnd(b.parentNode,i.findChildPosition(b)+1)},selectNode:function(b){this.setStartBefore(b);this.setEndAfter(b)},selectNodeContents:function(b){this.setStart(b,0);this.setEnd(b,i.getNodeLength(b))},collapse:function(b){b?this.setEnd(this.startContainer,
this.startOffset):this.setStart(this.endContainer,this.endOffset)},cloneContents:function(){return function a(h){for(var c,d=document.createDocumentFragment();c=h.next();)c=c.cloneNode(!h.hasPartialSubtree()),h.hasPartialSubtree()&&c.appendChild(a(h.getSubtreeIterator())),d.appendChild(c);return d}(new n(this))},extractContents:function(){var b=this.cloneRange();this.startContainer!=this.commonAncestorContainer&&this.setStartAfter(i.findClosestAncestor(this.commonAncestorContainer,this.startContainer));
this.collapse(!0);return function h(c){for(var b,e=document.createDocumentFragment();b=c.next();)c.hasPartialSubtree()?b=b.cloneNode(!1):c.remove(),c.hasPartialSubtree()&&b.appendChild(h(c.getSubtreeIterator())),e.appendChild(b);return e}(new n(b))},deleteContents:function(){var b=this.cloneRange();this.startContainer!=this.commonAncestorContainer&&this.setStartAfter(i.findClosestAncestor(this.commonAncestorContainer,this.startContainer));this.collapse(!0);(function h(c){for(;c.next();)c.hasPartialSubtree()?
h(c.getSubtreeIterator()):c.remove()})(new n(b))},insertNode:function(b){i.isDataNode(this.startContainer)?(i.splitDataNode(this.startContainer,this.startOffset),this.startContainer.parentNode.insertBefore(b,this.startContainer.nextSibling)):this.startContainer.insertBefore(b,this.startContainer.childNodes[this.startOffset]);this.setStart(this.startContainer,this.startOffset)},surroundContents:function(b){var a=this.extractContents();this.insertNode(b);console.log(this);b.appendChild(a);this.selectNode(b)},
compareBoundaryPoints:function(b,a){var h,c,d,e;switch(b){case g.START_TO_START:case g.START_TO_END:h=this.startContainer;c=this.startOffset;break;case g.END_TO_END:case g.END_TO_START:h=this.endContainer,c=this.endOffset}switch(b){case g.START_TO_START:case g.END_TO_START:d=a.startContainer;e=a.startOffset;break;case g.START_TO_END:case g.END_TO_END:d=a.endContainer,e=a.endOffset}return h.sourceIndex<d.sourceIndex?-1:h.sourceIndex==d.sourceIndex?c<e?-1:c==e?0:1:1},cloneRange:function(){var b=new g(this._document);
b.setStart(this.startContainer,this.startOffset);b.setEnd(this.endContainer,this.endOffset);return b},detach:function(){},toString:function(){return l.convertFromDOMRange(this).text},createContextualFragment:function(b){var a=(i.isDataNode(this.startContainer)?this.startContainer.parentNode:this.startContainer).cloneNode(!1);a.innerHTML=b;for(b=this._document.createDocumentFragment();a.firstChild;)b.appendChild(a.firstChild);return b}};n.prototype={range:null,_current:null,_next:null,_end:null,hasNext:function(){return!!this._next},
next:function(){var b=this._current=this._next;this._next=this._current&&this._current.nextSibling!=this._end?this._current.nextSibling:null;i.isDataNode(this._current)&&(this.range.endContainer==this._current&&(b=b.cloneNode(!0)).deleteData(this.range.endOffset,b.length-this.range.endOffset),this.range.startContainer==this._current&&(b=b.cloneNode(!0)).deleteData(0,this.range.startOffset));return b},remove:function(){if(i.isDataNode(this._current)&&(this.range.startContainer==this._current||this.range.endContainer==
this._current)){var b=this.range.startContainer==this._current?this.range.startOffset:0;this._current.deleteData(b,(this.range.endContainer==this._current?this.range.endOffset:this._current.length)-b)}else this._current.parentNode.removeChild(this._current)},hasPartialSubtree:function(){return!i.isDataNode(this._current)&&(i.isAncestorOrSelf(this._current,this.range.startContainer)||i.isAncestorOrSelf(this._current,this.range.endContainer))},getSubtreeIterator:function(){var b=new g(this.range._document);
b.selectNodeContents(this._current);i.isAncestorOrSelf(this._current,this.range.startContainer)&&b.setStart(this.range.startContainer,this.range.startOffset);i.isAncestorOrSelf(this._current,this.range.endContainer)&&b.setEnd(this.range.endContainer,this.range.endOffset);return new n(b)}};m.prototype={rangeCount:0,_document:null,_selectionChangeHandler:function(){this.rangeCount=this._selectionExists(this._document.selection.createRange())?1:0},_selectionExists:function(b,a){a===void 0&&(a=!0);return b.compareEndPoints("StartToEnd",
b)!=0||b.parentElement().isContentEditable&&a},addRange:function(b){var a=this._document.selection.createRange(),b=l.convertFromDOMRange(b);this._selectionExists(a,!1)?(b.compareEndPoints("StartToStart",a)==-1&&(b.compareEndPoints("StartToEnd",a)>-1&&b.compareEndPoints("EndToEnd",a)==-1?a.setEndPoint("StartToStart",b):b.compareEndPoints("EndToStart",a)<1&&b.compareEndPoints("EndToEnd",a)>-1&&a.setEndPoint("EndToEnd",b)),a.select()):b.select()},removeAllRanges:function(){this._document.selection.empty()},
getRangeAt:function(){var b=this._document.selection.createRange();return this._selectionExists(b)?l.convertToDOMRange(b,this._document):null},toString:function(){return this._document.selection.createRange().text}};if(window.getSelection===void 0){document.createRange=function(){return new g(document)};var o=new m(document);window.getSelection=function(){return o};window.DOMRange=g;window.DOMSelection=m}})();
(function(){var g,n,m,i,l,o=Array.prototype.indexOf||function(a){for(var h=0,c=this.length;h<c;h++)if(this[h]===a)return h;return-1},b=function(a,h){return function(){return a.apply(h,arguments)}};n=function(){function a(){this.browser=this.searchString(a.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"An unknown browser";this.OS=this.searchString(a.dataOS)||"An unknown OS"}a.prototype.searchString=function(a){var c,
b,e;for(b=0,e=a.length;b<e;b++)if(c=a[b],this.versionSearchString=c.versionSearch||c.identify,c.string!=null)if(c.string.indexOf(c.subString)!==-1)return c.identify;else if(c.prop)return c.identify;return[]};a.prototype.searchVersion=function(a){var c;c=a.indexOf(this.versionSearchString);return c===-1?void 0:parseFloat(a.substring(c+this.versionSearchString.length+1))};a.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identify:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",
versionSearch:"OmniWeb/",identify:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identify:"Safari",versionSearch:"Version"},{prop:window.opera,identify:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identify:"iCab"},{string:navigator.vendor,subString:"KDE",identify:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identify:"Firefox"},{string:navigator.vendor,subString:"Camino",identify:"Camino"},{string:navigator.userAgent,subString:"Netscape",identify:"Netscape"},
{string:navigator.userAgent,subString:"MSIE",identify:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identify:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identify:"Netscape",versionSearch:"Mozilla"}];a.dataOS=[{string:navigator.platform,subString:"Win",identify:"Windows"},{string:navigator.platform,subString:"Mac",identify:"Mac"},{string:navigator.userAgent,subString:"iPhone",identify:"iPhone/iPad"},{string:navigator.platform,subString:"Linux",
identify:"Linux"}];return a}();if(typeof exports!=="undefined"&&exports!==null)exports.Detector=n;l=function(a,h){var c,b;for(b in h)c=h[b],a.prototype[b]=c;return a};if(typeof exports!=="undefined"&&exports!==null)exports.partial=l;String.prototype.startsWith=function(a){return this.lastIndexOf(a,0)===0};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};m=function(){function a(){}a.prototype.CONTAINER_ELEMENTS="body,div,center,blockquote,li,td".split(",");a.prototype.BLOCK_ELEMENTS=
"address,dir,dl,form,h1,h2,h3,h4,h5,h6,hr,menu,noframes,ol,p,pre,table,ul,xmp".split(",");a.prototype.createElementFromHTML=function(a){var c;c=document.createElement("div");c.innerHTML=a;return c.firstChild};a.prototype.getTextContent=function(a,c){var b;c==null&&(c=!1);b=a.textContent||a.nodeValue;return c?b.trim():b};a.prototype.isContainerNode=function(a){var d;var c;return(d=(c=a.tagName)!=null?c.toLowerCase():void 0,a=d)&&o.call(this.CONTAINER_ELEMENTS,a)>=0};a.prototype.isBlockNode=function(a){var d;
var c;return(d=(c=a.tagName)!=null?c.toLowerCase():void 0,a=d)&&o.call(this.BLOCK_ELEMENTS,a)>=0};a.prototype.isInlineNode=function(a){return!this.isContainerNode(a&&!this.isBlockNode(a))};a.prototype.isVisibleNode=function(a){var c,b,e;if(a.nodeType===3)return a=this.getTextContent(a),a=a.replace(/\s\t\r\n/,""),a.length!==0;else{e=a.childNodes;for(c=0,b=e.length;c<b;c++)if(a=e[c],this.isVisibleNode(a)===!1)return!1;return!0}};a.prototype.isIsolateNode=function(a){return!a.nextSibling&&!a.previousSibling};
a.prototype.getNextNode=function(a){for(;!a.nextSibling;)if(a=a.parentNode,!a)return null;return a.nextSibling};a.prototype.getNextLeaf=function(a){for(a=this.getNextNode(a);(a!=null?a.firstChild:void 0)!=null;)a=a.firstChild;return a};a.prototype.getPreviousNode=function(a){for(;!a.previousSibling;)if(a=a.parentNode,!a)return null;return a.previousSibling};a.prototype.getPreviousLeaf=function(a){for(a=this.getPreviousNode(a);(a!=null?a.lastChild:void 0)!=null;)a=a.lastChild;return a};a.prototype.extractLeaf=
function(a,c,b){var e,f,j,k;c==null&&(c=void 0);b==null&&(b=void 0);f=this.getTextContent(a,!1);c==null&&(c=0);if(b==null)b=f.length;if(c===b||c===0&&b===f.length)return a;e=f.substring(0,c);c=f.substring(c,b);j=f.substring(b,f.length);b=a.nextSibling;f=a.parentNode;f.removeChild(a);e.length>0&&(a=document.createTextNode(e.trim()),this.isVisibleNode(a)&&f.insertBefore(a,b));c.length>0&&(k=document.createTextNode(c.trim()),f.insertBefore(k,b));j.length>0&&(a=document.createTextNode(j.trim()),this.isVisibleNode(a)&&
f.insertBefore(a,b));return k};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.NodeUtils=m;if(typeof require!=="undefined"&&require!==null)l=require("./partial").partial,m=require("./nodeutils.core").NodeUtils;m=l(m,{_unwrapNode:function(a){var b,c,d,e;d=a.parentNode;c=d.nextSibling;b=d.parentNode;b.removeChild(d);for(e=[];d.firstChild!=null;)a=d.firstChild,e.push(b.insertBefore(a,c));return e},unwrapNode:function(a,b,c){var d,e,f;for(c==null&&(c=!1);a.parentNode!=null&&(c||this.isIsolateNode(a));){d=
a.parentNode;if(e=(f=d.tagName)!=null?f.toLowerCase():void 0,o.call(b,e)>=0)return this._unwrapNode(a),!0;a=d}return!1},convertNode:function(a,b,c,d){var e,f,j,k;d==null&&(d=!1);for(j=function(a,b){var c,h;c=a.nextSibling;h=a.parentNode;for(h.removeChild(a);a.firstChild!=null;)b.appendChild(a.firstChild);return h.insertBefore(b,c)};a.parentNode!=null&&(d||this.isIsolateNode(a));){e=a.parentNode;f=(k=e.tagName)!=null?k.toLowerCase():void 0;if(o.call(b,f)>=0)return f===c.tagName.toLowerCase()?this._unwrapNode(a):
j(e,c),!0;a=e}return!1},wrapLeaf:function(a,b,c){var d,e,f;c==null&&(c=!0);if(!this.isVisibleNode(a))return!1;e=function(a,b){var c,h;c=a.nextSibling;h=a.parentNode;h.removeChild(a);try{b.appendChild(a)}catch(d){}return h.insertBefore(b,c)};f=function(a,b){var c,h,d,e,f;e=a.parentNode;f=null;if(a.previousSibling!=null){f=e.cloneNode(!1);for(c=a;c.previousSibling!=null;)c=c.previousSibling,f.insertBefore(c,f.firstChild)}d=null;if(a.nextSibling!=null){d=e.cloneNode(!1);for(c=a;c.nextSibling!=null;)c=
c.nextSibling,d.insertBefore(c,null)}h=e.nextSibling;c=e.parentNode;c.removeChild(e);f!=null&&c.insertBefore(f,h);b.appendChild(a);c.insertBefore(b,h);if(d!=null)return c.insertBefore(d,h)};if(this.isContainerNode(b)){if(c||!this.unwrapNode(a,[b.tagName.toLowerCase()],!0)){for(c=a;c.parentNode!=null;){d=c.parentNode;if(this.isContainerNode(d))return e(c,b),!0;c=d}e(a,b)}}else if(this.isBlockNode(b)){if(c||!this.convertNode(a,this.BLOCK_ELEMENTS,b,!0)){for(c=a;c.parentNode!=null;){d=c.parentNode;if(this.isContainerNode(d)&&
this.isBlockNode(d))return f(c,b),!0;c=d}for(c=a;c.parentNode!=null;){d=c.parentNode;if(this.isContainerNode(d))return e(c,b),!0;c=d}e(a,b)}}else(c||!this.unwrapNode(a,[b.tagName.toLowerCase()],!0))&&e(a,b);return!0},wrapNode:function(a,b,c,d,e){var f,j,k,g;c==null&&(c=!1);d==null&&(d=void 0);e==null&&(e=void 0);if(a.firstChild==null)return a=this.extractLeaf(a,d,e),this.wrapLeaf(a,b,c);d==null&&(d=0);if(e==null)e=a.childNodes.length;k=a.childNodes;g=[];for(f=0,j=k.length;f<j;f++)a=k[f],g.push(a!=
null?this.wrapNode(a,b,c,d,e):void 0);return g},wrapRange:function(a,b,c){var d,e,f,j,k,g;c==null&&(c=!1);if(a.startContainer===a.endContainer)return this.wrapNode(a.startContainer,b,c,a.startOffset,a.endOffset);if(!c&&(e=!1,this.isContainerNode(b)?e=this.convertNode(a.commonAncestorContainer,[(k=b.tagName)!=null?k.toLowerCase():void 0],b,!0):this.isBlockNode(b)&&(e=this.convertNode(a.commonAncestorContainer,this.BLOCK_ELEMENTS,b,!0)),e===!0))return!0;if(this.isContainerNode(b))b.appendChild(a.extractContents()),
a.insertNode(b);else{if(this.isBlockNode(b)){if(!function(a,b){var c;for(c=a;c!=null||c===b;){if(this.isBlockNode(c))return!0;c=this.getNextNode(c)}return!1}(a.startContainer,a.endContainer)){b.appendChild(a.extractContents());a.insertNode(b);return}j=!0}else j=!1;e=function(a){return j?this.getNextNode(a):this.getNextLeaf(a)};d=function(a){return j?this.getPreviousNode(a):this.getPreviousLeaf(a)};a.startContainer.firstChild!=null?k=a.startContainer.childNodes[a.startOffset]:(k=e(a.startContainer),
this.wrapNode(a.startContainer,b,c,a.startOffset,void 0));a.endContainer.firstChild!=null?d=a.endOffset>0?a.endContainer.childNodes[a.endOffset-1]:d(a.endContainer):(d=d(a.endContainer),this.wrapNode(a.endContainer,b,c,void 0,a.endOffset));for(g=[];k!=null&&k!==a.endContainer;){f=e(k);k.parentNode!=null&&this.wrapNode(k,b,c);if(k===d)break;g.push(k=f)}return g}},unwrapRange:function(a,b,c){c==null&&(c=!1);return this.unwrapNode(a.commonAncestorContainer,b,c)},convertRange:function(a,b,c,d){d==null&&
(d=!1);return this.convertNode(a.commonAncestorContainer,b,c,d)}});if(typeof exports!=="undefined"&&exports!==null)exports.NodeUtils=m;if(typeof require!=="undefined"&&require!==null)l=require("./partial").partial,m=require("./nodeutils.wrap").NodeUtils;m=l(m,{unstyleLeaf:function(a,b,c){var d,e,f;c==null&&(c=!1);for(d=c?"div":"span";a.parentNode!=null&&a.parentNode.tagName!=null;){c=a.parentNode;e=c.tagName.toLowerCase();if(e===d){for(e=0,f=b.length;e<f;e++)d=b[e],c.style[d]="";c.getAttribute("style")===
""&&this._unwrapNode(a);return!0}a=c}return!1},styleLeaf:function(a,b,c,d){var e,f,j,k,g,i,l,m,n;c==null&&(c=!1);d==null&&(d=!1);n=c?"div":"span";m=document.createElement(n);for(j in b)l=b[j],m.style[j]=l;i=function(){var a;a=[];for(j in b)l=b[j],a.push(j);return a}();f=function(a){var b,c,h;for(c=0,h=i.length;c<h;c++)if(b=i[c],a.style[b]!==m.style[b])return!1;return!0};for(e=a;e.parentNode!=null&&e.parentNode.tagName!=null;){k=e.parentNode;g=k.tagName.toLowerCase();if(g===n){if(!d&&f(k))this.unstyleLeaf(e,
i,c);else for(j in b)l=b[j],k.style[j]=l;return!0}e=k}this.wrapLeaf(a,m);return!0},styleNode:function(a,b,c,d,e,f){var j,k,g,i;c==null&&(c=!1);d==null&&(d=!1);e==null&&(e=void 0);f==null&&(f=void 0);if(a.firstChild==null)return a=this.extractLeaf(a,e,f),this.styleLeaf(a,b,c,d);e==null&&(e=0);if(f==null)f=a.childNodes.length;g=a.childNodes;i=[];for(j=0,k=g.length;j<k;j++)a=g[j],i.push(a!=null?this.styleNode(a,b,c,d,e,f):void 0);return i},styleRange:function(a,b,c,d){var e,f,j,g,i;c==null&&(c=!1);d==
null&&(d=!1);if(a.startContainer===a.endContainer)return this.styleNode(a.startContainer,b,c,d,a.startOffset,a.endOffset);f=function(a){return this.getNextLeaf(a)};e=function(a){return this.getPreviousLeaf(a)};a.startContainer.firstChild!=null?g=a.startContainer.childNodes[a.startOffset]:(g=f(a.startContainer),this.styleNode(a.startContainer,b,c,d,a.startOffset,void 0));a.endContainer.firstChild!=null?e=a.endOffset>0?a.endContainer.childNodes[a.endOffset-1]:e(a.endContainer):(e=e(a.endContainer),
this.styleNode(a.endContainer,b,c,d,void 0,a.endOffset));for(i=[];g!=null&&g!==a.endContainer;){j=f(g);g.parentNode!=null&&this.styleNode(g,b,c,d);if(g===e)break;i.push(g=j)}return i},unstyleRange:function(a,b,c,d){c==null&&(c=!1);d==null&&(d=!1);return this.unstyleLeaf(a.commonAncestorContainer,b,c,d)}});if(typeof exports!=="undefined"&&exports!==null)exports.NodeUtils=m;g=function(){function a(a){this.raw=a;this.utils=new m}a.prototype.execCommand=function(a,b,d){var e,f,g;d==null&&(d=!1);e=this.raw.window.getSelection();
if(e==null)return((f=window.console)!=null?f.error:void 0)!=null&&console.error("This browser does not support W3C type of range or Microsoft type of range."),!1;e=e.getRangeAt(0);switch(a){case "wrap":this.utils.wrapRange(e,this.utils.createElementFromHTML(b),d);break;case "unwrap":this.utils.unwrapRange(e,b,d);break;case "style":this.utils.styleRange(e,b,d);break;case "unstyle":this.utils.unstyleRange(e,b,d);break;case "insert":(new n).browser!=="Explorer"&&e.deleteContents();e.insertNode(this.utils.createElementFromHTML(b));
break;default:return((g=window.console)!=null?g.error:void 0)!=null&&console.error("Unknown command type has passed. type: "+a),!1}return!0};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.API=g;if(typeof require!=="undefined"&&require!==null)l=require("../utils/partial").partial,g=require("./api.core").API;g=l(g,{strong:function(){return this.execCommand("wrap","<strong>")},em:function(){return this.execCommand("wrap","<em>")},ins:function(){return this.execCommand("wrap","<ins>")},
del:function(){return this.execCommand("wrap","<del>")},sub:function(){return this.execCommand("wrap","<sub>")},sup:function(){return this.execCommand("wrap","<sup>")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=g;if(typeof require!=="undefined"&&require!==null)l=require("../utils/partial").partial,g=require("./api.core").API;g=l(g,{blockquote:function(){return this.execCommand("wrap","<blockquote>",!0)},unblockquote:function(){return this.execCommand("unwrap",["blockquote"],!0)},
heading:function(a){return this.execCommand("wrap","<h"+a+">")},h1:function(){return this.heading(1)},h2:function(){return this.heading(2)},h3:function(){return this.heading(3)},h4:function(){return this.heading(4)},h5:function(){return this.heading(5)},h6:function(){return this.heading(6)},p:function(){return this.execCommand("wrap","<p>")},pre:function(){return this.execCommand("wrap","<pre>")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=g;if(typeof require!=="undefined"&&require!==
null)l=require("../utils/partial").partial,g=require("./api.core").API;g=l(g,{a:function(a){return this.execCommand("wrap","<a href='"+a+"'>")},img:function(a){return this.execCommand("insert","<img src='"+a+"'>")},ul:function(){return this.raw.execCommand("insertUnorderedList")},ol:function(){return this.raw.execCommand("insertOrderedList")},hr:function(){return this.raw.execCommand("insertHorizontalRule")},table:function(a){var b,c,d,e,f;a==null&&(a=[5,5,"Table Caption"]);d=a[0];b=a[1];a=a[2];e=
function(){var a;a=[];for(c=0;0<=b?c<b:c>b;0<=b?c++:c--)a.push("    <td>XXX</td>");return a}();f=function(){var a;a=[];for(c=0;0<=d?c<d:c>d;0<=d?c++:c--)a.push("  <tr>\n"+e.join("\n")+"\n  </tr>");return a}();return this.execCommand("insert","<table>"+(a!=null?"\n<caption>"+a+"</caption>":"")+"\n"+f.join("\n")+"\n</table>")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=g;if(typeof require!=="undefined"&&require!==null)l=require("../utils/partial").partial,g=require("./commandapi.core").API;
g=l(g,{forecolor:function(a){return this.execCommand("style",{color:a})},backcolor:function(a){return this.execCommand("style",{backgroundColor:a})},fontfamily:function(a){return this.execCommand("style",{fontFamily:a})},fontsize:function(a){return this.execCommand("style",{fontSize:a})},justifyleft:function(){return this.execCommand("style",{textAlign:"left"},!0)},justifycenter:function(){return this.execCommand("style",{textAlign:"center"},!0)},justifyright:function(){return this.execCommand("style",
{textAlign:"right"},!0)},justifyfull:function(){return this.execCommand("style",{textAlign:"justify"},!0)}});if(typeof exports!=="undefined"&&exports!==null)exports.API=g;if(typeof require!=="undefined"&&require!==null)l=require("../utils/partial").partial,g=require("./api.core").API;g=l(g,{indent:function(){return this.raw.execCommand("indent")},outdent:function(){return this.raw.execCommand("outdent")}});if(typeof exports!=="undefined"&&exports!==null)exports.API=g;if(typeof require!=="undefined"&&
require!==null)n=require("./utils/detector").Detector;i=function(){function a(a){var c,d;this.iframe=a;c=new n;this._loaded=!1;this._callbacks=[];this.ready(b(function(){var a,d,h;this.document=this.iframe.contentDocument!=null?this.iframe.contentDocument:this.iframe.contentWindow.document;this.document.body==null&&this.document.writeln("<body></body>");this.body=this.document.body;this.body.style.cursor="text";this.body.style.height="100%";c.browser==="Explorer"&&c.version<9&&(d=b(function(){return this.body.style.height=
""+this.iframe.offsetHeight+"px"},this),setTimeout(b(function(){var a,b;((a=this.iframe)!=null?a.offsetHeight:void 0)!==((b=this.body)!=null?b.offsetHeight:void 0)&&d();return setTimeout(arguments.callee,100)},this),100));if(this.body.spellcheck!=null)this.body.spellcheck=!1;this.body.contentEditable!=null?this.body.contentEditable=!0:this.document.designMode!=null?this.document.designMode="On":((h=window.console)!=null?h.error:void 0)!=null&&console.error("This browser doesn't support contentEditable nor designMode");
this.window=this.iframe.contentWindow;if(this.window.getSelection==null)return this.document.createRange=b(function(){return new DOMRange(this.document)},this),a=new DOMSelection(this.document),this.window.getSelection=b(function(){this.body.focus();return a},this)},this));d=b(function(){var a,b,c,d;this._loaded=!0;d=this._callbacks;for(b=0,c=d.length;b<c;b++)a=d[b],a();return this._callbacks=void 0},this);this.iframe.getAttribute("src")!=null?c.browser==="Explorer"&&c.version<9?this.iframe.attachEvent("onreadystatechange",
b(function(){if(this.iframe.readyState==="complete")return this.iframe.onreadystatechange=null,d()},this)):this.iframe.addEventListener("load",b(function(){return d()},this),!1):d()}a.prototype.ready=function(a){a==null&&(a=void 0);return a==null?this._loaded:this._loaded?a():this._callbacks.push(a)};a.prototype.getValue=function(){if(this.ready())return this.body.innerHTML};a.prototype.setValue=function(a){if(this.ready())return this.body.innerHTML=a};a.prototype.execCommand=function(a,b,d){b==null&&
(b=!1);d==null&&(d=null);return this.document.execCommand(a,b,d)};a.prototype.queryCommandState=function(a){return this.document.queryCommandState(a)};a.prototype.queryCommandEnabled=function(a){return this.document.queryCommandEnabled(a)};a.prototype.queryCommandIndeterm=function(a){return this.document.queryCommandIndeterm(a)};a.prototype.queryCommandSupported=function(a){return this.document.queryCommandSupported(a)};a.prototype.queryCommandValue=function(a){return this.document.queryCommandValue(a)};
return a}();if(typeof exports!=="undefined"&&exports!==null)exports.Rawarea=i;this.Richarea=function(){function a(a){this.iframe=a;if(window.jQuery!=null&&this.iframe instanceof jQuery)this.iframe=this.iframe.get(0);this.raw=new i(this.iframe);this.raw.ready(b(function(){var a;if(this.iframe.innerHTML!=null)return a=this.iframe.innerHTML,a=a.split("&lt;").join("<"),a=a.split("&gt;").join(">"),this.setValue(a)},this));this.api=new g(this.raw)}a.prototype.ready=function(a){a==null&&(a=void 0);return this.raw.ready(a)};
a.prototype.getValue=function(){return this.raw.getValue()};a.prototype.setValue=function(a){return this.raw.setValue(a)};a.prototype.execCommand=function(a,b){var d;b==null&&(b=void 0);if(a in this.api)return this.api[a](b);else if(((d=window.console)!=null?d.error:void 0)!=null)return console.error("Command '"+a+"' not found.")};return a}();if(typeof exports!=="undefined"&&exports!==null)exports.Richarea=Richarea}).call(this);
